<ion-view title="我的优惠券" class="coupons" hide-tabs>
  <ion-content>
    <ion-refresher pulling-text="下拉刷新" on-refresh="vm.doRefresh()">
    </ion-refresher>
    <div class="coupon coupon-valid row" ng-repeat="item in vm.validCoupons" ng-init="brand=vm.getBrand(item.Coupon.brand_id)">
      <a class="coupon-info col col-67" ng-click="vm.useCoupons(item,brand);" >
        <p class="coupon-name">
          {{item.Coupon.name}}
        </p>
        <p>
          ￥<span class="coupon-price">{{item.Coupon.reduced_price /100 | currency : ''}}</span>
        </p>
        <p ng-show="item.Coupon.least_price > 0">
          订单满{{item.Coupon.least_price}}元使用（不含邮费）
        </p>
      </a>
      <div class="coupon-validity col col-33">
        <p class="text-muted">有效期</p>
        <p>
          {{item.Coupon.valid_begin | date:'MM.dd'}}~{{item.Coupon.valid_end | date:'MM.dd'}}
        </p>
        <p class="text-muted">{{vm.getCouponStatus(item)}}</p>
      </div>
    </div>
    
    <div class="centered-container" ng-show="vm.validCoupons.length == 0 && !vm.showInvalidCoupons">
      <span class="no-content no-coupons">
      </span>
      <span class="message">
        暂无优惠券
      </span>
    </div>

    <div class="padding" style="text-align:center">
      <p ng-click="vm.showInvalidCoupons = !vm.showInvalidCoupons" ng-show="vm.invalidCoupons.length > 0">
        {{vm.showInvalidCoupons ? '隐藏过期优惠券' : '查看过期优惠券'}}
      </p>
    </div>

    <div class="coupon coupon-invalid row" ng-repeat="item in vm.invalidCoupons" ng-init="brand=vm.getBrand(item.Coupon.brand_id)" ng-show="vm.showInvalidCoupons">
      <a class="coupon-info col col-67" ui-sref="store.home({storeId: brand.Brand.id, name: brand.Brand.name})">
        <p class="coupon-name">
          {{item.Coupon.name}}
        </p>
        <p>
          ￥<span class="coupon-price">{{item.Coupon.reduced_price /100 | currency : ''}}</span>
        </p>
        <p ng-show="item.Coupon.least_price > 0">
          订单满{{item.Coupon.least_price}}元使用（不含邮费）
        </p>
      </a>
      <div class="coupon-validity col col-33">
        <p class="text-muted">有效期</p>
        <p>
          {{item.Coupon.valid_begin | date:'MM.dd'}}~{{item.Coupon.valid_end | date:'MM.dd'}}
        </p>
        <p class="text-muted">{{vm.getCouponStatus(item)}}</p>
      </div>
    </div>
  </ion-content>
</ion-view>