<ion-view title="朋友说" hide-back-button='true' class="cart" show-tabs>
  <ion-header-bar align-title="left" class="bar-subheader padding" ng-show="!vm.isLoggedIn" > 
    <div class="row">
      <div class="col col-75 login-text">温馨提示：登陆后您可以同步电脑，微信与APP购物车中的商品。</div>
      <button class="button login-button" ui-sref="account-login">马上登陆</button>
    </div>
  </ion-header-bar>

  <ion-content style="{{vm.isLoggedIn?'padding-top:75px;':''}}">
    <ion-refresher pulling-text="下拉刷新" on-refresh="vm.doRefresh()">
    </ion-refresher>
    <div ng-repeat="brand in vm.brands" ng-show="vm.getCartItemsOfBrand(brand.Brand.id).length > 0">
      <span class="item item-icon-left item-avatar" ng-click="toStoreHomePage(brand);">
        <img src="{{brand.Brand.coverimg}}"></img>
        <i class="icon pys-350 {{vm.brandChecked(brand.Brand.id)?'icon-circle-checked circle-checked-icon':'icon-circle circle-icon'}}" ng-click="vm.toggleBrand(brand.Brand.id); $event.stopPropagation()" ng-show="!vm.editMode">
        </i>          
        <span>
          {{brand.Brand.name}}
        </span>
      </span>
      <ion-list can-swipe="true">
        <ion-item ng-repeat="cartItem in vm.getCartItemsOfBrand(brand.Brand.id)" ng-click="vm.toProductPage(cartItem);">
          <ion-option-button class="button-balanced" ng-click="vm.deleteCartItem(cartItem);">
            删除
          </ion-option-button>
          <div class="item-icon-left item-thumbnail-left">
            <img src="{{cartItem.Cart.coverimg}}"></img>
            <i class="icon pys-350 {{cartItem['checked']?'icon-circle-checked circle-checked-icon':'icon-circle circle-icon'}}" ng-click="vm.toggleCartItem(cartItem); $event.stopPropagation()">
              </span>
            </i>
            <span class="product-content">
              <div class="text">
                {{cartItem.Cart.name}}
              </div>
              <span class="text-sub-muted" ng-show="!cartItem.editMode && !_.isEmpty(cartItem.Cart.spec)">
                {{cartItem.Cart.spec}}
              </span>
              <span class="number-span" ng-show="cartItem.editMode">
                <span class="pys-350 icon-reduce count-reduce" ng-click="vm.reduceCartItemNum(cartItem.Cart)"></span>
                <span class="count">
                  <input disabled="disabled" ng-model="cartItem.Cart.num" style="background-color: #fff"/>
                </span>
                <span class="pys-350 icon-add count-add" ng-click="vm.addCartItemNum(cartItem.Cart)"></span>
              </span>
            </span>
            <span class="product-rest">
              <span class="product-price">
                {{cartItem.Cart.price | currency:"￥"}}
              </span>
              <span class="product-num">
                ×{{cartItem.Cart.num}}
              </span>
              <span class="pys-350 {{cartItem.editMode ? 'icon-save save-icon':'icon-edit edit-icon'}}" ng-click="vm.clickSaveOrEditBtn(cartItem); $event.stopPropagation()">
              </span>
            </span>
          </div>
        </ion-item>
        <div class="item-divider"></div>
      </ion-list>
    </div>

    <div class="centered-container" ng-show="vm.brands.length == 0">
      <span class="no-content no-cart-items">
      </span>
      <span class="message">
        购物车还是空的，去选点好吃的吧！
      </span>
      <a class="button button-energized" ng-click="toHomePage()">去逛逛</a>
    </div>
  </ion-content>
  
  <ion-footer-bar ng-show="vm.brands.length > 0" class="item item-icon-left row">
    <span class="icon pys-350 {{vm.allBrandsChecked()?'icon-circle-checked':'icon-circle'}}" ng-click="vm.allBrandsChecked() ? vm.uncheckAllCartItems():vm.checkAllCartItems();"></span>
    <div class="col-20">
      <div>合计</div>
      <div class="text-sub-muted">不含运费</div>
    </div>
    <span class="text-energized col">
      ￥<span class="text-large">{{vm.getTotalPrice() | currency:""}}</span>
    </span>
    <div class="button button-energized col-25" ng-click="vm.confirmCart()" ng-disabled="!vm.readyToConfirm()"><strong>结算({{vm.getCheckedNumber()}})</strong></div>
  </ion-footer-bar>
</ion-view>